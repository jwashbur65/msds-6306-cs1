---
title: "Analysis"
author: "Lavonnia Newman, Joseph Caguioa, Jeff Washburn"
date: "12/7/2018"
output: 
  html_document:
    theme: default
    highlight: tango
    toc: true
    toc_depth: 3
    toc_float:
      collapsed: false

---

```{r setup, include=FALSE, message=F}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("psych")
library(knitr)
library(ggplot2)
library(dplyr)
library(plyr)
library(psych)

```

# Placeholder. RMarkdown file should contain:
* Formal introduction to client.
* Code explanations as sentences before or after chunks.
* Explicit answers to following 7 questions, given in sentences outside code chunks.
* Project conclusion summarizing findings.

# Data Cleansing

``` {r clean}

# Create new working copies.
beers_raw <- read.csv("./Analysis/Beers.csv", header=TRUE, sep=",")
breweries_raw <- read.csv("./Analysis/Breweries.csv", header=TRUE, sep=",")

# Create new working copies.
beers_clean <- data.frame(beers_raw)
breweries_clean <- data.frame(breweries_raw)

# Change column name of brewery ID to match for merging.
names(beers_clean)[names(beers_clean) == "Brewery_id"] <- "Brewery_ID"
names(beers_clean)[names(beers_clean) == "Name"] <- "Beer_Name"
names(breweries_clean)[names(breweries_clean) == "Brew_ID"] <- "Brewery_ID"
names(breweries_clean)[names(breweries_clean) == "Name"] <- "Brewery_Name"

# Change data types of Names to character. Style, City, and State stay factors.
beers_clean$Beer_Name <- as.character(beers_clean$Beer_Name)
breweries_clean$Brewery_Name <- as.character(breweries_clean$Brewery_Name)

```

# The questions:
## 1. How many breweries are present in each state? 
(Alongside a nicely formatted table, consider a choropleth map if possible.)

``` {r numbreweries}

# How many breweries are there per state? Uses count() from plyr.
breweries_count_state <- count(breweries_clean, "State")
names(breweries_count_state)[names(breweries_count_state) == "freq"] <- c("Num_Breweries")

# Bar graph visualization.
bps_bars <- breweries_count_state %>% ggplot(aes(x = reorder(State, Num_Breweries), y = Num_Breweries)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("Number of Breweries Per State") +
  xlab("State") +
  ylab("Number of Breweries") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.ticks = element_blank()
        )
bps_bars

```

## 2. Merge beer data with breweries data. 
Print first 6 observations and last 6 observations to check merged file.

```{r merge}

merged_beers_raw <- merge(beers_clean, breweries_clean, by = c("Brewery_ID", "Brewery_ID"), all = TRUE)
merged_beers_raw <- merged_beers_raw[c("Beer_Name", "Beer_ID", "ABV", 
                               "IBU", "Style", "Ounces",
                               "Brewery_Name", "Brewery_ID", "City", "State")]

kable(head(merged_beers_raw, 6), format="markdown")
kable(tail(merged_beers_raw, 6), format="markdown")

```

## 3. Report number of NAs in each column.

```{r numnas}

# Report the number of NAs in each column.
num_nas <- colSums(is.na(merged_beers_raw))
num_nas
```

## 4. Compute median alcohol content and international bitterness unit for each state. 
Plot a bar chart to compare.

```{r medians_state}
#Calculating the median and ignoring NA
abv_state_median<-aggregate(merged_beers_raw$ABV, list(merged_beers_raw$State), median, na.rm=TRUE)
ibu_state_median<-aggregate(merged_beers_raw$IBU, list(merged_beers_raw$State), median, na.rm=TRUE)

names(abv_state_median)<-c("State", "Median ABV")
names(ibu_state_median)<-c("State", "Median IBU")
```
### 4.1 ABV Median
``` {r}
#Output the results
kable(abv_state_median, format="markdown")
```
### 4.2 IBU Median
``` {r}
kable(ibu_state_median, format="markdown")
```


# Another comment here to test things.

## 5. Which state has maximum ABV beer? Most bitter beer in IBU? 
(Consider bar chart again, with top [5/10] in each category. However, highlight the number 1.)
```{r "abv-ibu echo=TRUE"}
abv_max <- max(merged_beers_raw$ABV, na.rm=TRUE)
ibu_max <- max(merged_beers_raw$IBU, na.rm=TRUE)
abv_max
ibu_max

#Convert State from Factor to Character
merged_beers_raw$State <- as.character(merged_beers_raw$State)

#Determine the highest ABV in each State (return by State)
abv.agg <- aggregate(ABV ~ State, merged_beers_raw, max)

#Now Sort the states by ABV descending
sorted_abv_agg<-abv.agg %>% arrange(desc(ABV))
first_ten_abv<-head(sorted_abv_agg, 10)
kable( head(first_ten_abv, 10), format="markdown")


#Determine the highest IBU in each State (return by State)
ibu.agg <- aggregate(IBU ~ State, merged_beers_raw, max)

#Now Sort the states by IBU descending
sorted_ibu_agg<-ibu.agg %>% arrange(desc(IBU))
kable( head(sorted_ibu_agg, 10), format="markdown")


#Now let's graph ABV (top 10)
abv_beers <- first_ten_abv %>% ggplot(aes(x= reorder(State, desc(ABV)), y = ABV)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  ggtitle("States by ABV") +
  xlab("State") +
  ylab("ABV") +
  theme(plot.title = element_text(hjust = 0.5), axis.ticks = element_blank()) + 
  theme(axis.text.x = element_text(angle = -90))
abv_beers
```

## 6. Summary statistics for ABV.
```{r "abv-summary-stats echo=TRUE"}
summary(merged_beers_raw$ABV)
```

## 7. Is there a relationship between IBU and ABV? 
Draw a scatterplot. (Use linear regression to quantify the relationship, provide R^2.)
```{r "IBU-to-ABV echo=TRUE"}
abv_ibu_scatter <-
 merged_beers_raw %>% ggplot(aes(x = ABV, y = IBU)) +
 geom_point(na.rm = TRUE, alpha = 0.5, col="#F19800") +
 xlab("Alcohol By Volume (ABV)") +
 ylab("International Bitterness Units (IBU)") +
 ggtitle("Relationship Between Beerâ€™s\nBitterness and Alcoholic Content") +
 # Test with both method="lm" and ="loess" for linear and smooth regressions.
 geom_smooth(method = "lm", se = TRUE, level = 0.95,
             aes(color = "CC720C", fill = "#F28E1C")
             ) +
 theme(plot.title = element_text(hjust = 0.5),
       axis.ticks = element_blank()
       )
abv_ibu_scatter
```
Results - There appears to be a positive correlation between ABV and IBU.  The higher the alcoholic content (ABV) the higher the bitterness (IBU).

